# 浏览器渲染帧探究

浏览器渲染帧探究（后面还有 fiber）

React 的渲染原理

React 的 concurrent mode（处理可中断渲染）

useTransition：非常关键，因为如果你想让你的 react 项目的丝滑程度更上一层楼，那么在你所有的优化手段都用完以后，你必须要去面对的一个东西时 react 的调度策略，而 useTranstion 是目前 react 提供给我们的唯一和调度策略打交道的入口

王者荣耀、和平精英 原神

手机一发烫就掉帧 渲染帧 一旦掉帧就会出现什么情况 ---> 卡 画面在卡 按什么技能都不管用

帧：一帧画面

一个动态的画面，实际上是由 n 个静态画面来组成，只不过这些画面切换的极快，所以你感觉不出来他们是静态的画面，而是感觉象是动态的电影

这里面的每一个静态画面我们都称之为一帧
（打团的时候一帧要做的事情太多了 ，正常 10ms，但是打团花了 200ms，后面的十多帧就全部被顶掉了）

浏览器也是一样的，他也是一帧一帧渲染的 比方说

淘宝，当你 hover 上去的时候 对应的回调事件触发，然后 js 引擎告诉浏览器下一帧渲染的时候要记得将 hover 的区域变成红色

切换画面的速度：称之为【帧率】

一秒钟的帧率越高 那么你切换画面的速度越快 那么你的感知就越流畅

浏览器的帧率是：一秒钟 60 帧 也就意味着 16 毫秒一帧（1000/60 = 16.6）

掉帧：某一帧要做的事情太多了，导致某一帧的执行时间远超过预期时间 【比方说预期一帧是 16ms，但是该帧实际走了 100ms，那么他会顶掉其他本该给该绘制的帧】

浏览器：掉帧就是指一帧要做的事情太多了，占用的时间太长了，导致其他的帧被卡掉了

浏览器的一帧大概会做哪些事情：

1. 处理用户的交互事件（input、click）【上一帧传递过来的用户的对应事件的回调事件】
2. 调用 requestAnimationFrame 【后面说】
3. 执行重排重绘【重新绘制一帧 dom】
4. 调用 requestIdleCallback【如果还有空闲时间的话】

浏览器掉了一帧：这一阵不再进行重排重绘，这个画面直接没了，同时你所注册的 requestAnimationFrame 以及 requestIdleCallback 将不再执行

用户的交互事件还会处理吗？？不会

如果我们想尽可能地稳定浏览器的帧率，那我们要确保一帧做的事情不要太多

之前 Vue 你会发现如果你首屏的代码太多了，这个时候用户的输入框就会失效

同样的代码量：Vue 在首屏的时候可能会掉帧，但 React 不会 Vue 是一旦渲染开始，就不能停止

React 调度机制，优先级概念，react 的渲染是可以中断的

什么叫做浏览器渲染帧？
浏览器一帧做了什么事情？
浏览器掉帧的后果是什么？
